<https://stackoverflow.com/questions/11227809/why-is-it-faster-to-process-a-sorted-array-than-an-unsorted-array>

### 问题：

下面是一段很神奇的 C++ 代码，因为某种未知的原因，排序后的数组执行速率快了近 6 倍。

```c++
#include <algorithm>
#include <ctime>
#include <iostream>

int main()
{
    // Generate data
    const unsigned arraySize = 32768;
    int data[arraySize];

    for (unsigned c = 0; c < arraySize; ++c)
        data[c] = std::rand() % 256;

    // !!! With this, the next loop runs faster
    std::sort(data, data + arraySize);

    // Test
    clock_t start = clock();
    long long sum = 0;

    for (unsigned i = 0; i < 100000; ++i)
    {
        // Primary loop
        for (unsigned c = 0; c < arraySize; ++c)
        {
            if (data[c] >= 128)
                sum += data[c];
        }
    }

    double elapsedTime = static_cast<double>(clock() - start) / CLOCKS_PER_SEC;

    std::cout << elapsedTime << std::endl;
    std::cout << "sum = " << sum << std::endl;
}
```

- 如果不加`std::sort(data, data + arraySize)`这句代码的话，所耗时间为 11.54 秒。
- 如果加上去，只耗了 1.93 秒。

起初，我认为可能是语言或者编译器搞的鬼，所以我用 Java 试了下。

```java
import java.util.Arrays;
import java.util.Random;

public class Main
{
    public static void main(String[] args)
    {
        // Generate data
        int arraySize = 32768;
        int data[] = new int[arraySize];

        Random rnd = new Random(0);
        for (int c = 0; c < arraySize; ++c)
            data[c] = rnd.nextInt() % 256;

        // !!! With this, the next loop runs faster
        Arrays.sort(data);

        // Test
        long start = System.nanoTime();
        long sum = 0;

        for (int i = 0; i < 100000; ++i)
        {
            // Primary loop
            for (int c = 0; c < arraySize; ++c)
            {
                if (data[c] >= 128)
                    sum += data[c];
            }
        }

        System.out.println((System.nanoTime() - start) / 1000000000.0);
        System.out.println("sum = " + sum);
    }
}
```

最后的结果也是类似。

我起初的想法是，排序导致了缓存，所以后续的执行会更快，但后来想了想，不对，因为数组已经生成在那里了，缓存也在。

- 这到底是怎么回事呢？
- 为什么处理一段已排序的数组比处理一段未排序的数组快？
- 代码只是做些加法这些运算，顺序应该不会造成影响啊。

### 最佳回答：



### 其它回答：
